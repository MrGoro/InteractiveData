<!DOCTYPE html>
<html lang="en">
<head>
    <title>Climate in Hamburg and Munich</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <style>
        .glyphicon.spinning {
            font-size: 50px;
            animation: spin 1s infinite linear;
            -webkit-animation: spin2 1s infinite linear;
        }

        @keyframes spin {
            from { transform: scale(1) rotate(0deg);}
            to { transform: scale(1) rotate(360deg);}
        }

        @-webkit-keyframes spin2 {
            from { -webkit-transform: rotate(0deg);}
            to { -webkit-transform: rotate(360deg);}
        }

        .spinner{
            position: absolute;
            height: 100px;
            width: 100px;
            top: 50%;
            left: 50%;
            margin-left: -50px;
            margin-top: -50px;
            z-index: 11;
        }

        #graph {
            position: relative;
        }

        .overlay {
            opacity: .5;
            filter: Alpha(Opacity=50);
            background-color: #f6f6f6;
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 10;
        }

        .axis path,
        .axis line {
            fill: none;
            stroke: #000;
            shape-rendering: crispEdges;
        }

        .line {
            fill: none;
            stroke: steelblue;
            stroke-width: 2px;
        }

        .grid-background {
            fill: #ddd;
        }

        .axisBrush path {
            display: none;
        }

        .axisBrush line {
            fill: none;
            stroke: #000;
            shape-rendering: crispEdges;
        }

        .grid line,
        .grid path {
            fill: none;
            stroke: #fff;
            shape-rendering: crispEdges;
        }

        .grid .minor.tick line {
            stroke-opacity: .5;
        }

        .brush .extent {
            stroke: #000;
            fill-opacity: .125;
            shape-rendering: crispEdges;
        }

        .toggle {
            position: fixed;
            top: 50%;
            height: 100px;
            width: 50px;
            font-size: 5em;
        }

        .next {
            right: 50px;
        }

        .previous {
            left: 20px;
        }
    </style>
</head>
<body>
<div class="container">

    <h1>Climate in Hamburg and Munich</h1>
    <h2>Comparison of temperature and humidity since 1949</h2>

    <div id="spinner" class="spinner">
        <span class="glyphicon glyphicon-refresh spinning"></span>
    </div>
    <div id="graph" class="overlay"></div>
</div>
<div class="toggle previous" id="previous">
    <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
</div>
<div class="toggle next" id="next">
    <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.6/moment.min.js" charset="UTF-8"></script>
<script src="https://code.jquery.com/jquery-2.1.4.min.js" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
<script src="Chart.js" charset="UTF-8"></script>
<script src="Picker.js" charset="UTF-8"></script>
<script src="climate.js" charset="UTF-8"></script>
<script type="application/javascript">

    $("#next").on("click", function() {
        picker.next();
    });

    $("#previous").on("click", function() {
        picker.previous();
    });

    var loading = function(state) {
        if(state) {
            $("#spinner").show();
            $("#graph").addClass("overlay");
        } else {
            $("#spinner").hide();
            $("#graph").removeClass("overlay");
        }
    };

    var error = function(error) {
        console.log(error);
        alert("Error! Something went wrong. Try again later.")
    };

    var success = function(result1, result2, init) {
        var data = [
            {
                name: "Hamburg",
                data: adjustData(result1.data[0])
            }, {
                name: "Munich",
                data: adjustData(result2.data[0])
            }
        ];

        showChart(data, init);
    };

    function convertDate(dateArray) {
        //              YEAR                       MONTH              DAY                HOUR               MINUTE             SECOND
        return new Date(dateArray[0] || dateArray, dateArray[1] || 1, dateArray[2] || 1, dateArray[3] || 0, dateArray[4] || 0, dateArray[5] || 0);
    }

    function adjustData(data) {
        var newData = [];
        for (var i=0; i<data.length; ++i) {
            newData.push({
                date: convertDate(data[i][0]),
                value: data[i][1]
            });
        }
        return newData;
    }

    function updateBoundaries(start, end) {
        picker.selected(moment(start), moment(end));
    }

    function reset() {
        picker.reset();
    }

    var start = moment("1950-01-01"),
        end = moment("1959-12-31"),
        min = moment("1950-01-01"),
        max = moment("2009-12-31"),
        granularity = Granularity.YEAR;
    var picker = new Picker(min.clone(), max.clone(), start.clone(), end.clone(), granularity);
    var chart = new Chart("/api/sensor/temperature", success, error, loading, picker);
</script>
</body>
</html>
